.read ../outputs/ultima-patagonia.sql
.output outputs/latest_findings.csv 
.headers on 
.mode csv 
SELECT  SURV2.NAME as parent,SURV.NAME as survey ,C.TOPO_DATE as date, SUM(S.ADJ_LENGTH) as total_length
FROM STATION as STN1, STATION as STN2, CENTRELINE as C, SURVEY as SURV, SURVEY as SURV2, SHOT as S
WHERE (STN1.ID = S.FROM_ID AND STN2.ID = TO_ID) AND STN2.NAME != "." AND STN2.NAME != "-" AND STN1.SURVEY_ID = SURV.ID AND STN2.SURVEY_ID = SURV.ID AND S.CENTRELINE_ID = C.ID AND C.TOPO_DATE > "2022.12.31" AND C.SURVEY_ID = SURV.ID AND SURV.PARENT_ID = SURV2.ID
GROUP BY SURV.NAME ORDER BY C.TOPO_DATE;

